<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>go workspace简单使用 | bing随遇而安</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="
为什么会有go workspace
基于Go Module的开发，代码组织有以下两种方式:
整个项目为一个Module，Module下再拆分为多个功能包
根据不同功能将项目拆分为多个Module

两种方式各有优缺点，其中:
整个项目为一个Module，各个功能包都在一个Module下，代码变更是实时生效的。但是其中业务代码和功能代码等放在一起，高度耦合。多个项目 ...">
    
    <link rel="preload" href="/assets/css/0.styles.29350883.css" as="style"><link rel="preload" href="/assets/js/app.64d8c0d5.js" as="script"><link rel="preload" href="/assets/js/6.38d57c41.js" as="script"><link rel="preload" href="/assets/js/3.122d5fd9.js" as="script"><link rel="preload" href="/assets/js/32.3b323386.js" as="script"><link rel="prefetch" href="/assets/js/10.c71c2b73.js"><link rel="prefetch" href="/assets/js/11.059f07af.js"><link rel="prefetch" href="/assets/js/12.d23da198.js"><link rel="prefetch" href="/assets/js/13.cb896045.js"><link rel="prefetch" href="/assets/js/14.f7014cd5.js"><link rel="prefetch" href="/assets/js/15.38ff99fb.js"><link rel="prefetch" href="/assets/js/16.dc5bdee6.js"><link rel="prefetch" href="/assets/js/17.dc7e2fb9.js"><link rel="prefetch" href="/assets/js/18.ef545b08.js"><link rel="prefetch" href="/assets/js/19.68950198.js"><link rel="prefetch" href="/assets/js/20.f1270bba.js"><link rel="prefetch" href="/assets/js/21.04d56666.js"><link rel="prefetch" href="/assets/js/22.5e896baf.js"><link rel="prefetch" href="/assets/js/23.debc6822.js"><link rel="prefetch" href="/assets/js/24.d8fb30f0.js"><link rel="prefetch" href="/assets/js/25.458d330e.js"><link rel="prefetch" href="/assets/js/26.76f15208.js"><link rel="prefetch" href="/assets/js/27.859efef4.js"><link rel="prefetch" href="/assets/js/28.f0a291b2.js"><link rel="prefetch" href="/assets/js/29.58082007.js"><link rel="prefetch" href="/assets/js/30.ea79ae69.js"><link rel="prefetch" href="/assets/js/31.db5c98f9.js"><link rel="prefetch" href="/assets/js/33.613d7121.js"><link rel="prefetch" href="/assets/js/34.200439b4.js"><link rel="prefetch" href="/assets/js/35.b63338e3.js"><link rel="prefetch" href="/assets/js/36.78b890da.js"><link rel="prefetch" href="/assets/js/4.380f1af6.js"><link rel="prefetch" href="/assets/js/5.084c9b71.js"><link rel="prefetch" href="/assets/js/7.358fd391.js"><link rel="prefetch" href="/assets/js/8.d351dd84.js"><link rel="prefetch" href="/assets/js/9.bf0c8df5.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.ac365ac7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29350883.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">bing随遇而安 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">bing随遇而安 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">BING随遇而安</span> <span itemprop="address">   in Shanghai</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2023-01-05T00:00:00.000Z">
      Thu Jan 05 2023
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/golang" data-v-42ccfcd5><span data-v-42ccfcd5>golang</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="go-workspace简单使用"><a href="#go-workspace简单使用" class="header-anchor">#</a> go workspace简单使用</h1> <h2 id="为什么会有go-workspace"><a href="#为什么会有go-workspace" class="header-anchor">#</a> 为什么会有go workspace</h2> <p>基于Go Module的开发，代码组织有以下两种方式:</p> <ul><li>整个项目为一个Module，Module下再拆分为多个功能包</li> <li>根据不同功能将项目拆分为多个Module</li></ul> <p>两种方式各有优缺点，其中:</p> <ul><li>整个项目为一个Module，各个功能包都在一个Module下，代码变更是实时生效的。但是其中业务代码和功能代码等放在一起，高度耦合。多个项目之间的公共代码不方便共享。</li> <li>根据不同功能将项目拆分为多个Module，优点是代码之前低耦合，Module之间根据需要相互依赖。缺点是项目依赖的Module改动后，如果用到的改动后的功能就需要先发布依赖Module到代码仓库，然后在项目中更新依赖Module。</li></ul> <p>针对上面所说的将项目拆分成多个Module，依赖Module需要先发布再更新的问题，有以下两个解决方案:</p> <ul><li>使用Go Module中的replace指令，在项目中将依赖替换为本地Module</li> <li>使用go workspace工作区模式，使用统一的go.work来维护依赖映射</li></ul> <div class="language-go extra-class"><pre class="language-go"><code>
module github<span class="token punctuation">.</span>com<span class="token operator">/</span>xxxxxxx<span class="token operator">/</span>gin<span class="token operator">-</span>framework<span class="token operator">-</span>layout

<span class="token keyword">go</span> <span class="token number">1.19</span>

require <span class="token punctuation">(</span>
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>xxxxxxx<span class="token operator">/</span>gin<span class="token operator">-</span>framework<span class="token operator">-</span>core v0<span class="token punctuation">.</span><span class="token number">0.1</span>
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>xxxxxxx<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">-</span>utils v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20221028065316</span><span class="token operator">-</span>8abebfd58706
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>dgrijalva<span class="token operator">/</span>jwt<span class="token operator">-</span><span class="token keyword">go</span> v3<span class="token punctuation">.</span><span class="token number">2.0</span><span class="token operator">+</span>incompatible
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>gin<span class="token operator">-</span>gonic<span class="token operator">/</span>gin v1<span class="token punctuation">.</span><span class="token number">8.1</span>
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>swaggo<span class="token operator">/</span>files v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20220728132757</span><span class="token operator">-</span>551d4a08d97a
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>swaggo<span class="token operator">/</span>gin<span class="token operator">-</span>swagger v1<span class="token punctuation">.</span><span class="token number">5.3</span>
	github<span class="token punctuation">.</span>com<span class="token operator">/</span>swaggo<span class="token operator">/</span>swag v1<span class="token punctuation">.</span><span class="token number">8.7</span>
<span class="token punctuation">)</span>

replace github<span class="token punctuation">.</span>com<span class="token operator">/</span>xxxxxxx<span class="token operator">/</span>gin<span class="token operator">-</span>framework<span class="token operator">-</span>core <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>gin<span class="token operator">-</span>framework<span class="token operator">-</span>core v0<span class="token punctuation">.</span><span class="token number">0.1</span>
</code></pre></div><ol><li>replace在开发项目的go.mod文件中将依赖Module使用replace指令替换为本地项目。优点是不需要每次都发布和更新Module，缺点是在每次发布的时候都需要注释掉本地的replace指令。</li> <li>go workspace工作区模式，是在项目的同级目录创建go.work文件，来使用go.work文件来统一维护当前目录下所有Module之间的依赖，同时也不需要将go.work纳入版本管理，也不需要每次都去删掉或者注释掉相关内容。具体如何使用go workspace,请参照下面示例。</li></ol> <h2 id="go-workspace的用法"><a href="#go-workspace的用法" class="header-anchor">#</a> go workspace的用法</h2> <p>我们以的xxxxxxx框架为例，为了代码之间低耦合，我们将框架拆封为三个Module。</p> <ul><li><a href="https://github.com/xxxxxxx/gin-framework-core" target="_blank" rel="noopener noreferrer">gin-framework-core<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Module, 基于gin封装的web框架核心，包括加载配置服务、日志服务、数据库操作和redis换成操作等，依赖于函数库go-utils。</li> <li><a href="https://github.com/xxxxxxx/go-utils" target="_blank" rel="noopener noreferrer">go-utils<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Module, go公共函数库，公共函数都放在这个Module下面，包括md5、http request、nodelog等封装。</li> <li><a href="https://github.com/xxxxxxx/gin-framework-layout" target="_blank" rel="noopener noreferrer">gin-framework-layout<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Module, 基于gin框架封装的业务开发模版，其内部实现了mvc+router服务，依赖于gin-framework-core和go-utils Module。</li></ul> <p>我们在开发过程中需要同时改到上面三个Module，同时我们希望改动能够实时生效、发布代码到gitea时也不改动任何配置。具体可以这样做:</p> <h6 id="新建go代码目录"><a href="#新建go代码目录" class="header-anchor">#</a> 新建go代码目录</h6> <div class="language-bash extra-class"><pre class="language-bash"><code>root@huge-elk:~<span class="token comment"># mkdir ~/webdata/go -p</span>
root@huge-elk:~<span class="token comment"># cd ~/webdata/go/</span>
root@huge-elk:~/webdata/go<span class="token comment"># </span>
</code></pre></div><h6 id="拉取gin-framework-core-gin-framework-layout-go-utils三个仓库"><a href="#拉取gin-framework-core-gin-framework-layout-go-utils三个仓库" class="header-anchor">#</a> 拉取gin-framework-core,gin-framework-layout,go-utils三个仓库</h6> <div class="language-bash extra-class"><pre class="language-bash"><code>root@huge-elk:~/webdata/go<span class="token comment"># git clone git@github.com:xxxxxxx/gin-framework-core.git</span>
Cloning into <span class="token string">'gin-framework-core'</span><span class="token punctuation">..</span>.
The authenticity of <span class="token function">host</span> <span class="token string">'github.com (192.168.74.97)'</span> can<span class="token string">'t be established.
RSA key fingerprint is SHA256:oltXuIRprs+uMUAwCCYY3qiLjQDmE0lP4eINNqxB1sw.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>github.com<span class="token string">' (RSA) to the list of known hosts.
remote: Enumerating objects: 40, done.
remote: Counting objects: 100% (40/40), done.
remote: Compressing objects: 100% (40/40), done.
remote: Total 40 (delta 14), reused 0 (delta 0)
Receiving objects: 100% (40/40), 34.46 KiB | 1.08 MiB/s, done.
Resolving deltas: 100% (14/14), done.
root@huge-elk:~/webdata/go# git clone git@github.com:xxxxxxx/gin-framework-layout.git
Cloning into '</span>gin-framework-layout<span class="token string">'...
remote: Enumerating objects: 35, done.
remote: Counting objects: 100% (35/35), done.
remote: Compressing objects: 100% (30/30), done.
remote: Total 35 (delta 8), reused 0 (delta 0)
Receiving objects: 100% (35/35), 32.98 KiB | 2.20 MiB/s, done.
Resolving deltas: 100% (8/8), done.
root@huge-elk:~/webdata/go# git clone git@github.com:xxxxxxx/go-utils.git
Cloning into '</span>go-utils'<span class="token punctuation">..</span>.
remote: Enumerating objects: <span class="token number">16</span>, done.
remote: Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">16</span>/16<span class="token punctuation">)</span>, done.
remote: Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">11</span>/11<span class="token punctuation">)</span>, done.
remote: Total <span class="token number">16</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
Receiving objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">16</span>/16<span class="token punctuation">)</span>, <span class="token number">4.27</span> KiB <span class="token operator">|</span> <span class="token number">874.00</span> KiB/s, done.
root@huge-elk:~/webdata/go<span class="token comment"># ll</span>
total <span class="token number">20</span>
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:15 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 gin-framework-core/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 gin-framework-layout/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 go-utils/
root@huge-elk:~/webdata/go<span class="token comment"># </span>
</code></pre></div><h6 id="使用go-work-init来创建workspace"><a href="#使用go-work-init来创建workspace" class="header-anchor">#</a> 使用go work init来创建workspace</h6> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># moddirs是Go Module所在的本地目录。如果有多个Go Module，就用空格分开。如果go work init后面没有参数，会创建一个空的workspace。</span>
go work init <span class="token punctuation">[</span>moddirs<span class="token punctuation">]</span>

<span class="token comment">## 初始化workspace</span>
root@huge-elk:~/webdata/go<span class="token comment"># go work init ./gin-framework-layout</span>
root@huge-elk:~/webdata/go<span class="token comment"># ll</span>
total <span class="token number">24</span>
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:22 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:15 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 gin-framework-core/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 gin-framework-layout/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:19 go-utils/
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">36</span> Nov  <span class="token number">2</span> <span class="token number">10</span>:22 go.work
root@huge-elk:~/webdata/go<span class="token comment"># </span>

<span class="token comment">## 查看workspace内容</span>
root@huge-elk:~/webdata/go<span class="token comment"># cat go.work </span>
go <span class="token number">1.18</span>

use ./gin-framework-layout
root@huge-elk:~/webdata/go<span class="token comment"># </span>
</code></pre></div><h6 id="使用go-work-use来添加依赖"><a href="#使用go-work-use来添加依赖" class="header-anchor">#</a> 使用go work use来添加依赖</h6> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 如果要给workspace新增Go Module，可以使用如下命令.或者手动编辑go work文件。如果带有-r参数，会递归查找-r后面的路径参数下的所有子目录，把所有包含go.mod文件的子目录都添加到go work文件中。</span>
go work use <span class="token punctuation">[</span>-r<span class="token punctuation">]</span> moddir

<span class="token comment">### 注意: 如果某个Go Module的目录已经被加到go.work里了，后面该目录没有go.mod文件了或者该目录被删除了，那对该目录再次执行go work use命令，该目录的use指令会从go.work文件里自动移除。(注意：自动移除要从Go 1.18正式版本才会生效，Go 1.18beta1版本有bug，自动删除不会生效)</span>

<span class="token comment"># 添加gin-framework-core,go-utils依赖</span>
root@huge-elk:~/webdata/go<span class="token comment"># go work use ./gin-framework-core ./go-utils/</span>
root@huge-elk:~/webdata/go<span class="token comment"># cat go.work </span>
go <span class="token number">1.18</span>

use <span class="token punctuation">(</span>
        ./gin-framework-core
        ./gin-framework-layout
        ./go-utils
<span class="token punctuation">)</span>
</code></pre></div><p>这样我们就可以修改go目录下的三个module中的任意一个，代码是实时生效的。而且对于代码发布流程不会有任何影响。</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#为什么会有go-workspace" title="为什么会有go workspace">为什么会有go workspace</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#go-workspace的用法" title="go workspace的用法">go workspace的用法</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.64d8c0d5.js" defer></script><script src="/assets/js/6.38d57c41.js" defer></script><script src="/assets/js/3.122d5fd9.js" defer></script><script src="/assets/js/32.3b323386.js" defer></script>
  </body>
</html>
