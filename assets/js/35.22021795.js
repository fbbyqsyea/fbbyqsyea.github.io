(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{342:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"内网goproxy服务搭建配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内网goproxy服务搭建配置"}},[s._v("#")]),s._v(" 内网goproxy服务搭建配置")]),s._v(" "),t("h3",{attrs:{id:"goproxy是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#goproxy是什么"}},[s._v("#")]),s._v(" goproxy是什么")]),s._v(" "),t("p",[s._v("goproxy是go模块代理服务，主要用来加速获取go模块。官方默认的proxy为:"),t("a",{attrs:{href:"https://proxy.golang.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://proxy.golang.org"),t("OutboundLink")],1),s._v(", 国内主要使用的proxy是由七牛云提供的"),t("a",{attrs:{href:"https://goproxy.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://goproxy.cn/"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"为什么要在内网搭建goproxy服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要在内网搭建goproxy服务"}},[s._v("#")]),s._v(" 为什么要在内网搭建goproxy服务")]),s._v(" "),t("ul",[t("li",[s._v("内网自建的goproxy不仅可以访问公网的模块，还可以访问内网的 git server")]),s._v(" "),t("li",[s._v("缓存业务用到的公网第三方模块，防止公网仓库变更或者消失，导致线上编译失败或者紧急回退失败")]),s._v(" "),t("li",[s._v("防止公司内部开发人员配置不当造成 import path 泄露")]),s._v(" "),t("li",[s._v("cache热点依赖，提升代码编译速度等")])]),s._v(" "),t("h3",{attrs:{id:"搭建流程-我们以ubuntu系统为例进行安装。primary为goproxy机器-huge-elk为研发机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建流程-我们以ubuntu系统为例进行安装。primary为goproxy机器-huge-elk为研发机器"}},[s._v("#")]),s._v(" 搭建流程(我们以ubuntu系统为例进行安装。primary为goproxy机器，huge-elk为研发机器)")]),s._v(" "),t("h4",{attrs:{id:"golang安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#golang安装"}},[s._v("#")]),s._v(" golang安装")]),s._v(" "),t("p",[s._v("通过国内go资源网站studygolang下载安装:"),t("a",{attrs:{href:"https://studygolang.com/dl",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://studygolang.com/dl"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 下载对应系统的golang")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://studygolang.com/dl/golang/go1.19.2.linux-amd64.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 解压到指定目录")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar zxvf go1.19.2.linux-amd64.tar.gz -C /usr/local")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 将go命令添加到/usr/bin")]),s._v("\nroot@primary:/usr/bin"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ln /usr/local/go/bin/go -s /usr/bin/go")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看go命令是否安装成功")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go version")]),s._v("\ngo version go1.19.2 linux/amd64\n")])])]),t("h4",{attrs:{id:"git安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#git安装"}},[s._v("#")]),s._v(" git安装")]),s._v(" "),t("p",[s._v("ubuntu默认已经安装git。如未安装，请通过官网下载安装:"),t("a",{attrs:{href:"https://git-scm.com/downloads",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://git-scm.com/downloads"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 git version命令来查看是否安装成功")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# git version")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.34")]),s._v(".1\n")])])]),t("h4",{attrs:{id:"goproxy安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#goproxy安装"}},[s._v("#")]),s._v(" goproxy安装")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 拉取goproxy代码")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# git clone https://github.com/goproxyio/goproxy.git")]),s._v("\nCloning into "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'goproxy'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nremote: Enumerating objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(", done.\nremote: Counting objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/27"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", done.\nremote: Compressing objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("/21"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", done.\nremote: Total "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", reused "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", pack-reused "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v("\nReceiving objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v("/530"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139.72")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266.00")]),s._v(" KiB/s, done.\nResolving deltas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("225")]),s._v("/225"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", done.\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 安装make")]),s._v("\nroot@primary:~/goproxy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install make -y")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## make安装goproxy")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd goproxy")]),s._v("\nroot@primary:~/goproxy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make")]),s._v("\n\ngo: downloading github.com/prometheus/client_golang v1.9.0\ngo: downloading golang.org/x/mod v0.4.0\ngo: downloading github.com/goproxyio/windows v0.0.0-20191126033816-f4a809841617\ngo: downloading github.com/prometheus/client_model v0.2.0\ngo: downloading github.com/prometheus/common v0.15.0\ngo: downloading golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543\ngo: downloading github.com/beorn7/perks v1.0.1\ngo: downloading github.com/cespare/xxhash/v2 v2.1.1\ngo: downloading github.com/golang/protobuf v1.4.3\ngo: downloading github.com/prometheus/procfs v0.2.0\ngo: downloading golang.org/x/sys v0.0.0-20201214210602-f9fddec55a1e\ngo: downloading github.com/matttproud/golang_protobuf_extensions v1.0.1\ngo: downloading google.golang.org/protobuf v1.23.0\ngo: downloading github.com/google/go-cmp v0.4.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 将goproxy二进制文件移动到指定目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 安装完成后goproxy下会多出bin目录，将bin目录移动到/usr/local/goproxy")]),s._v("\nroot@primary:~/goproxy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /usr/local/goproxy")]),s._v("\nroot@primary:~/goproxy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv ./bin /usr/local/goproxy/")]),s._v("\nroot@primary:~/goproxy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/local/goproxy/bin/")]),s._v("\nroot@primary:/usr/local/goproxy/bin"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8464")]),s._v("\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":15 ./\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root   root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8658944")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":15 goproxy*\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 将goproxy命令添加到/usr/bin")]),s._v("\nroot@primary:/usr/bin"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ln /usr/local/goproxy/bin/goproxy -s /usr/bin/goproxy")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看goproxy命令是否安装成功")]),s._v("\nroot@primary:/usr/local/goproxy/bin"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# goproxy -h")]),s._v("\nUsage of goproxy:\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cacheDir")]),s._v(" string\n    \tGo Modules cache dir, default is "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/pkg/mod/cache/download\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cacheExpire")]),s._v(" duration\n    \tGo Modules cache expiration "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", default is "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" min "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default 5m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-exclude")]),s._v(" string\n    \texclude "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" pattern, you can exclude internal Git services\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-listen")]),s._v(" string\n    \t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" listen address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:8081"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-proxy")]),s._v(" string\n    \tnext hop proxy "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Go Modules, recommend use https://gopropxy.io\n")])])]),t("h4",{attrs:{id:"goproxy命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#goproxy命令"}},[s._v("#")]),s._v(" goproxy命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 执行goproxy -h命令查看goproxy命令帮助")]),s._v("\nroot@primary:/usr/local/goproxy/bin"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# goproxy -h")]),s._v("\nUsage of goproxy:\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cacheDir")]),s._v(" string\n    \tGo Modules cache dir, default is "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/pkg/mod/cache/download\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cacheExpire")]),s._v(" duration\n    \tGo Modules cache expiration "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", default is "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" min "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default 5m0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-exclude")]),s._v(" string\n    \texclude "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" pattern, you can exclude internal Git services\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-listen")]),s._v(" string\n    \t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" listen address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:8081"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-proxy")]),s._v(" string\n    \tnext hop proxy "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Go Modules, recommend use https://gopropxy.io\n\n")])])]),t("ul",[t("li",[s._v("-cacheDir   go module缓存目录，默认$GOPATH/pkg/mod/cache/download")]),s._v(" "),t("li",[s._v("-cacheExpire go module缓存时长(分钟)， 默认5分钟")]),s._v(" "),t("li",[s._v("-exclude 排除指定host模式，你可以排除内部git server host")]),s._v(" "),t("li",[s._v("-listen 监听host和端口， 默认0.0.0.0:8081")]),s._v(" "),t("li",[s._v("-proxy  go module上游代理, 推荐使用 https://gopropxy.io")])]),s._v(" "),t("h4",{attrs:{id:"启动goproxy服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动goproxy服务"}},[s._v("#")]),s._v(" 启动goproxy服务")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 新建cache dir")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /usr/local/goproxy/cache")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 使用nohup命令，在后台启动goproxy进程")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nohup goproxy -cacheDir=/usr/local/goproxy/cache -exclude=gitea.example.com -listen=0.0.0.0:80 -proxy=https://goproxy.cn > /tmp/goproxy.log 2>&1 &")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23261")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps aux | grep gop")]),s._v("\nroot@primary:/usr/local/goproxy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps aux | grep gop")]),s._v("\nroot        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3441")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1154944")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7376")]),s._v(" pts/0    Sl   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":24   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 goproxy "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cacheDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/goproxy/cache "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-exclude")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gitea.example.com "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-listen")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://goproxy.cn\nroot        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3449")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2064")]),s._v(" pts/0    S+   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":25   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto gop\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看goproxy服务机器IP地址 如果已经将域名解析到goproxy服务机器，可以直接使用域名。")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip addr")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": enp0s2: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc fq_codel state UP group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether ca:3b:cc:0e:10:69 brd ff:ff:ff:ff:ff:ff\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".64.3/24 metric "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".64.255 scope global dynamic enp0s2\n       valid_lft 74713sec preferred_lft 74713sec\n    inet6 fd4a:5ec3:8409:4846:c83b:ccff:fe0e:1069/64 scope global dynamic mngtmpaddr noprefixroute\n       valid_lft 2591984sec preferred_lft 604784sec\n    inet6 fe80::c83b:ccff:fe0e:1069/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n       valid_lft forever preferred_lft forever\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 到这里我们基本的内网goproxy服务就启动了，goproxy服务的地址为:http://192.168.64.3")]),s._v("\n")])])]),t("h4",{attrs:{id:"研发机配置goproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#研发机配置goproxy"}},[s._v("#")]),s._v(" 研发机配置goproxy")]),s._v(" "),t("p",[s._v("在开发机器上配置"),t("b",[s._v("GOPROXY")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 研发机器继续使用ubuntu")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看go环境变量")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GO111MODULE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOARCH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"amd64"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOBIN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOCACHE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/.cache/go-build"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOENV")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/.config/go/env"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOEXE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOEXPERIMENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOHOSTARCH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"amd64"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOHOSTOS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOINSECURE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOMODCACHE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/go/pkg/mod"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GONOPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GONOSUMDB")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOOS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/go"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPRIVATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://proxy.golang.org,direct"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOROOT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/go-1.18"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOSUMDB")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sum.golang.org"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOTMPDIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOTOOLDIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/go-1.18/pkg/tool/linux_amd64"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOVCS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOVERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.18.1"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GCCGO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gccgo"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOAMD64")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ar"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CC")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gcc"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CXX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"g++"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_ENABLED")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOMOD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/null"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOWORK")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_CFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g -O2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_CPPFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_CXXFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g -O2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_FFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g -O2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_LDFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g -O2"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PKG_CONFIG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pkg-config"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOGCCFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build2599397427=/tmp/go-build -gno-record-gcc-switches"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置GO111MODULE=on, 使用mod模式开发")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env -w GO111MODULE=on")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 将GOPROXY设置为我们配置的内网host")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env -w GOPROXY=http://192.168.64.3,direct")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看修改是否生效")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env GO111MODULE GOPROXY")]),s._v("\non\nhttp://192.168.64.3,direct\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 拉取公网go模块 ")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go install github.com/fbbyqsyea/wechat@latest")]),s._v("\ngo: downloading github.com/fbbyqsyea/wechat v0.0.4\npackage github.com/fbbyqsyea/wechat is not a main package\n")])])]),t("h4",{attrs:{id:"拉取内网gitea-go模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取内网gitea-go模块"}},[s._v("#")]),s._v(" 拉取内网gitea go模块")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 要拉取gitea代码，goproxy机器必须配置对应仓库的访问权限")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 生成SSH密钥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 1. 进入 ~/.ssh目录")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ~/.ssh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2. 使用ssh-keygen命令生成rsa公私钥 id_rsa_git为秘钥名称，不要设置密码，直接按几次回车键，完成密钥创建")]),s._v("\nroot@primary:~/.ssh"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen -t rsa")]),s._v("\nGenerating public/private rsa key pair.\nEnter "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" to save the key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/root/.ssh/id_rsa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": id_rsa_git\nEnter passphrase "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empty "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" no passphrase"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\nEnter same passphrase again:\nYour identification has been saved "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" id_rsa_git\nYour public key has been saved "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" id_rsa_git.pub\nThe key fingerprint is:\nSHA256:URSu2NTjQomvYIyRF3U+A0XCkHT7V7AHz/1RazPCil0 root@primary\nThe key's randomart image is:\n+---"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("RSA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3072")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("----+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   ."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("o+.*.    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("o.B "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("  o"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  o "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o O "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("E.* "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("   B *o+o o.+"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" + "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" S.oo    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SHA256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("-----+\nroot@primary:~/.ssh"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\ndrwx------ "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":39 ./\ndrwx------ "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":37 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("562")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":08 authorized_keys\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2602")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":39 id_rsa_git\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("566")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":39 id_rsa_git.pub\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 配置gitea公钥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 1.获取公钥内容")]),s._v("\nroot@primary:~/.ssh"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat id_rsa_git.pub")]),s._v("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCi+BCfnmWmI+6LsIfB42op5Y5a7MuxPw3PQb4uy5p/OEjDTN+XfCg763V7/0ZR0jL1Brer6zgOczm5FaVbIgbdwc7KXBE4fhqDJMdlDmWWaP71jaVbzdQnLkGE88xXqKG0gZT+n+JwJbC+ZymAkwZsOJvWa0TWIcL9MVgspyN19R8ZuvUJ6iws+rhx//6EPDa3FPkkzAD7LLkDRqb6rd+Ml8jhmN21x2aPU6R6WIXJbHqN3r5Rs9d58oHS/60e+Z2uYiHYr9oxs4Vun6YZCY2x1c5rfJOlHlOtZI9T5n2GScRykVBbNCp4OEv69Ga8xN6q2k6oQKYylF7+7J99S9nOUvX95E0sVGcNAHBupAZ4xst/y/XL8QQxNwn1+cEwuOHJp0er8qHp83kPqAn/8pQwzT+6UTfKfcj+eP9w742an9eIwtcjD1FBYvKqUkh0739vvshFBJOHSF/LQMRo8ARU8AfAxfhkTqc4O98xADwDTxKCZ3HHZNkK7SB/1XMiXiU"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root@primary\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2.使用有权限的账号登录gitea并且配置公钥，配置路径:Gitea “用户设置 -> SSH/GPG秘钥 -> 管理 SSH 密钥 ->增加秘钥")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 配置本地私钥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 1.打开~/.ssh/config，添加如下内容")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ~/.ssh/config")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/config")]),s._v("\n Host *\n HostkeyAlgorithms +ssh-rsa\n PubkeyAcceptedKeyTypes +ssh-rsa\n\n Host gitea.example.com\n HostName gitea.example.com\n Port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n User "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n IdentityFile ~/.ssh/id_rsa_git\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 2. 给config文件可执行权限")]),s._v("\nroot@primary:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod a+x ~/.ssh/config")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改git clone方式")]),s._v("\nroot@primary:~/.ssh"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# git config --global url."ssh://git@gitea.example.com".insteadOf "https://gitea.example.com"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 由于gitea https证书已过期，所以设置GOINSECURE变量，忽略gitea.example.com https校验")]),s._v("\nroot@primary:~/.ssh"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env -w GOINSECURE=gitea.example.com")]),s._v("\nroot@primary:~/.ssh"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env GOINSECURE")]),s._v("\ngitea.example.com\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 测试安装内网gitea项目 (研发机器)")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go install gitea.example.com/goweb/gin-framework-layout@latest")]),s._v("\ngo: downloading gitea.example.com/goweb/gin-framework-layout v0.0.0-20221028094355-547f7a489c3b\ngo: gitea.example.com/goweb/gin-framework-layout@latest: gitea.example.com/goweb/gin-framework-layout@v0.0.0-20221028094355-547f7a489c3b: verifying module: gitea.example.com/goweb/gin-framework-layout@v0.0.0-20221028094355-547f7a489c3b: reading http://192.168.64.3/sumdb/sum.golang.org/lookup/gitea.example.com/goweb/gin-framework-layout@v0.0.0-20221028094355-547f7a489c3b: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" Not Found\n\tserver response: not found: gitea.example.com/goweb/gin-framework-layout@v0.0.0-20221028094355-547f7a489c3b: unrecognized "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitea.example.com/goweb/gin-framework-layout"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" https fetch: Get "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://gitea.example.com/goweb/gin-framework-layout?go-get=1"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" dial tcp: lookup gitea.example.com on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8:53: no such "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 目前gin-framework-layout模块安装成功，但是sum校验失败，设置内部项目忽略校验 (研发机器)")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env -w GONOSUMDB=gitea.example.com")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重新安装")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go clean -modcache")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env -w GONOSUMDB=gitea.example.com")]),s._v("\nroot@huge-elk:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go install gitea.example.com/goweb/gin-framework-layout@latest")]),s._v("\ngo: downloading gitea.example.com/goweb/gin-framework-layout v0.0.0-20221028094355-547f7a489c3b\ngo: downloading gitea.example.com/goweb/gin-framework-core v0.0.1\ngo: downloading github.com/gin-gonic/gin v1.8.1\ngo: downloading github.com/go-redis/redis v6.15.9+incompatible\ngo: downloading github.com/go-sql-driver/mysql v1.6.0\ngo: downloading github.com/jmoiron/sqlx v1.3.5\ngo: downloading github.com/spf13/viper v1.13.0\ngo: downloading go.uber.org/zap v1.23.0\ngo: downloading gopkg.in/natefinch/lumberjack.v2 v2.0.0\ngo: downloading github.com/Masterminds/squirrel v1.5.3\ngo: downloading github.com/mcuadros/go-defaults v1.2.0\ngo: downloading github.com/gin-contrib/sse v0.1.0\ngo: downloading github.com/mattn/go-isatty v0.0.14\ngo: downloading golang.org/x/net v0.1.0\ngo: downloading github.com/fsnotify/fsnotify v1.5.4\ngo: downloading github.com/mitchellh/mapstructure v1.5.0\ngo: downloading github.com/spf13/afero v1.8.2\ngo: downloading github.com/spf13/cast v1.5.0\ngo: downloading github.com/spf13/jwalterweatherman v1.1.0\ngo: downloading github.com/spf13/pflag v1.0.5\ngo: downloading go.uber.org/atomic v1.7.0\ngo: downloading go.uber.org/multierr v1.6.0\ngo: downloading gitea.example.com/goweb/go-utils v0.0.0-20221028065316-8abebfd58706\ngo: downloading github.com/dgrijalva/jwt-go v3.2.0+incompatible\ngo: downloading github.com/lann/builder v0.0.0-20180802200727-47ae307949d0\ngo: downloading github.com/go-playground/validator/v10 v10.10.0\ngo: downloading github.com/pelletier/go-toml/v2 v2.0.5\ngo: downloading github.com/pelletier/go-toml v1.9.5\ngo: downloading github.com/ugorji/go/codec v1.2.7\ngo: downloading google.golang.org/protobuf v1.28.0\ngo: downloading gopkg.in/yaml.v2 v2.4.0\ngo: downloading golang.org/x/sys v0.1.0\ngo: downloading golang.org/x/text v0.4.0\ngo: downloading github.com/subosito/gotenv v1.4.1\ngo: downloading github.com/hashicorp/hcl v1.0.0\ngo: downloading gopkg.in/ini.v1 v1.67.0\ngo: downloading github.com/magiconair/properties v1.8.6\ngo: downloading gopkg.in/yaml.v3 v3.0.1\ngo: downloading github.com/lann/ps v0.0.0-20150810152359-62de8c46ede0\ngo: downloading github.com/go-playground/universal-translator v0.18.0\ngo: downloading github.com/leodido/go-urn v1.2.1\ngo: downloading golang.org/x/crypto v0.0.0-20220411220226-7b82a4e95df4\ngo: downloading github.com/go-playground/locales v0.14.0\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitea.example.com/goweb/gin-framework-layout")]),s._v("\ngo/pkg/mod/gitea.example.com/goweb/gin-framework-layout@v0.0.0-20221028094355-547f7a489c3b/main.go:9:7: undefined: core.New\nnote: module requires Go "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),s._v("\n\n\n到这里我们内网goproxy服务搭建配置成功\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);